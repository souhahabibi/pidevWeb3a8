{% extends 'client_base.html.twig' %}

{% block breadcrumb %}
<section class="breadcrumb-section set-bg mb-4" data-setbg="{{asset('clientSalle/img/about-breadcrumb-bg.jpg')}}">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="site-text">
                    <h2>{% block title %}OUR PRODUCTS{% endblock %}</h2>
                    <div class="site-breadcrumb">
                        <a href="./home.html" class="sb-item">Home</a>
                        <span class="sb-item">{% block page %}products{% endblock %}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block body %}
<a href="{{ path('app_panier') }}">
        <img src="{{ asset('clientSalle/img/panier.png') }}" alt="panier" class="btn-img" width="40" height="40">
    </a>
    <div class="row">
        <div class="col-lg-12">
            <div class="col-lg-12">
                <div class="section-title">
                    <h2>Search Bar</h2>
                    <input type="text" id="searchInput" placeholder="Search " oninput="search()">
                </div>  
            </div>
            
        </div>
    </div>

    {% if produits is empty %}
        <p>Aucun produit trouvé.</p>
    {% else %}
        <div class="row">
            {% for produit in produits %}
                <div class="col-lg-3 col-md-6 mb-4"> <!-- Changement de la classe col-lg-4 à col-lg-3 pour afficher 4 cartes par ligne -->
                    <div class="card">
                        {% if produit.image %}
                            <img src="{{ asset('adminSalle/img/' ~ produit.image) }}" class="card-img-top" alt="Image du produit" style="max-height: 200px;"> <!-- Réglage de la taille maximale de l'image -->
                        {% else %}
                            <div class="text-center">Pas d'image</div>
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title text-center">{{ produit.nom }}</h5>
                            <p class="card-text"><small class="text-muted">Description: {{ produit.description }}</small></p>
           <p class="card-text"><small class="text-muted">Prix initial: {{ produit.prixInitial }}</small></p>
                            {% if produit.prixPromo is not null %}
                                <p class="card-text"><small class="text-danger">Prix avec promotion: {{ produit.prixPromo }}</small></p>
                            {% else %}
                                <p class="card-text"><small class="text-muted">Pas de promo</small></p>
                            {% endif %}

                            <p class="card-text"><small class="text-muted">Date d'expiration: {{ produit.dateExpiration ? produit.dateExpiration|date('Y-m-d') : 'N/A' }}</small></p>
                            <div class="text-right">
                            <a href="{{ path('app_qr_codes', {'id': produit.idProduit}) }}" class="btn btn-danger">QR Code</a>
                                <a href="{{ path('add_panier', {'id': produit.idProduit}) }}" class="btn btn-danger">Ajouter panier</a>
                                
                            </div>
                        </div>
                    </div>
                </div>
                {% if loop.index % 4 == 0 %}</div><div class="row">{% endif %} <!-- Changement de la condition pour afficher 4 cartes par ligne -->
            {% endfor %}
        </div>
    {% endif %}

    <script>
        function search() {
            // Récupère la valeur de la recherche
            let input = document.getElementById("searchInput").value.toUpperCase();

            // Récupère tous les éléments à filtrer
            let items = document.querySelectorAll(".col-lg-3");

            // Parcours tous les éléments et masque ceux qui ne correspondent pas à la recherche
            for (let i = 0; i < items.length; i++) {
                let item = items[i];
                let name = item.querySelector(".card-title").textContent.toUpperCase();
                let description = item.querySelector(".card-text:first-of-type").textContent.toUpperCase();
                let cost = item.querySelector(".card-text:nth-of-type(2)").textContent.toUpperCase(); // Utilisation de nth-of-type pour sélectionner le deuxième .card-text

                if (name.indexOf(input) > -1 || description.indexOf(input) > -1 || cost.indexOf(input) > -1) {
                    item.style.display = "";
                } else {
                    item.style.display = "none";
                }
            }
        }
    </script>
{% endblock %}
